!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Chessground=e()}}(function(){var e;return function t(e,n,r){function o(i,c){if(!n[i]){if(!e[i]){var u="function"==typeof require&&require;if(!c&&u)return u(i,!0);if(a)return a(i,!0);var l=new Error("Cannot find module '"+i+"'");throw l.code="MODULE_NOT_FOUND",l}var s=n[i]={exports:{}};e[i][0].call(s.exports,function(t){var n=e[i][1][t];return o(n?n:t)},s,s.exports,t,e,n,r)}return n[i].exports}for(var a="function"==typeof require&&require,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(e,t,n){function r(e,t){var n=new a(t);return o.render(e,i(n)),c(n)}var o=e("mithril"),a=e("./ctrl"),i=e("./view"),c=e("./api");t.exports=r,t.exports.controller=a,t.exports.view=i,t.exports.fen=e("./fen"),t.exports.util=e("./util"),t.exports.configure=e("./configure"),t.exports.anim=e("./anim"),t.exports.board=e("./board"),t.exports.drag=e("./drag")},{"./anim":4,"./api":5,"./board":6,"./configure":7,"./ctrl":8,"./drag":10,"./fen":12,"./util":16,"./view":17,mithril:3}],2:[function(e,t,n){!function(e){function n(e,t){if("object"!==o(e))return t;for(var r in t)e[r]="object"===o(e[r])&&"object"===o(t[r])?n(e[r],t[r]):t[r];return e}function r(e,t,r){var i=r[0],c=r.length;(e||"object"!==o(i))&&(i={});for(var u=0;c>u;++u){var l=r[u],s=o(l);if("object"===s)for(var d in l){var f=e?a.clone(l[d]):l[d];i[d]=t?n(i[d],f):f}}return i}function o(e){return{}.toString.call(e).slice(8,-1).toLowerCase()}var a=function(e){return r(e===!0,!1,arguments)},i="merge";a.recursive=function(e){return r(e===!0,!0,arguments)},a.clone=function(e){var t,n,r=e,i=o(e);if("array"===i)for(r=[],n=e.length,t=0;n>t;++t)r[t]=a.clone(e[t]);else if("object"===i){r={};for(t in e)r[t]=a.clone(e[t])}return r},e?t.exports=a:window[i]=a}("object"==typeof t&&t&&"object"==typeof t.exports&&t.exports)},{}],3:[function(t,n,r){var o=function a(e,t){"use strict";function n(e){return"function"==typeof e}function r(e){return"[object Object]"===ge.call(e)}function o(e){return"[object String]"===ge.call(e)}function i(e){se=e.document,de=e.location,pe=e.cancelAnimationFrame||e.clearTimeout,fe=e.requestAnimationFrame||e.setTimeout}function c(e,t){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];if(r(e))return W(e,n);var i,c=null!=t&&r(t)&&!("tag"in t||"view"in t||"subtree"in t),u=c?t:{},l="class"in u?"class":"className",s={tag:"div",attrs:{}},d=[];if(!o(e))throw new Error("selector in m(selector, attrs, children) should be a string");for(;null!=(i=me.exec(e));)if(""===i[1]&&i[2])s.tag=i[2];else if("#"===i[1])s.attrs.id=i[2];else if("."===i[1])d.push(i[2]);else if("["===i[3][0]){var f=be.exec(i[3]);s.attrs[f[1]]=f[3]||(f[2]?"":!0)}var p=c?n.slice(1):n;s.children=1===p.length&&ve(p[0])?p[0]:p;for(var h in u)u.hasOwnProperty(h)&&(h===l&&null!=u[h]&&""!==u[h]?(d.push(u[h]),s.attrs[h]=""):s.attrs[h]=u[h]);return d.length&&(s.attrs[l]=d.join(" ")),s}function u(e,t){for(var n=0;n<e.length&&!t(e[n],n++););}function l(e,t){u(e,function(e,n){return(e=e&&e.attrs)&&null!=e.key&&t(e,n)})}function s(e){return null==e||null==e.toString()?"":e}function d(e,t,n,r){try{p(e,t,n),t.nodeValue=r}catch(o){}}function f(e){for(var t=0;t<e.length;t++)ve(e[t])&&(e=e.concat.apply([],e),t--);return e}function p(e,t,n){e.insertBefore(t,e.childNodes[n]||null)}function h(e,t,n,r){l(e,function(e,r){t[e=e.key]=t[e]?{action:Pe,index:r,from:t[e].index,element:n.nodes[t[e].index]||se.createElement("div")}:{action:Ce,index:r}});var o=[];for(var a in t)o.push(t[a]);var i=o.sort(B),c=new Array(n.length);return c.nodes=n.nodes.slice(),u(i,function(t){var o=t.index;if(t.action===xe&&(U(n[o].nodes,n[o]),c.splice(o,1)),t.action===Ce){var a=se.createElement("div");a.key=e[o].attrs.key,p(r,a,o),c.splice(o,0,{attrs:{key:e[o].attrs.key},nodes:[a]}),c.nodes[o]=a}if(t.action===Pe){var i=t.element,u=r.childNodes[o];u!==i&&null!==i&&r.insertBefore(i,u||null),c[o]=n[t.from],c.nodes[o]=i}}),c}function v(e,t,n,r){var o=e.length!==t.length;return o||l(e,function(e,n){var r=t[n];return o=r&&r.attrs&&r.attrs.key!==e.key}),o?h(e,n,t,r):t}function g(e,t,n){u(e,function(e,r){null!=t[r]&&n.push.apply(n,t[r].nodes)}),u(t.nodes,function(e,r){null!=e.parentNode&&n.indexOf(e)<0&&U([e],[t[r]])}),e.length<t.length&&(t.length=e.length),t.nodes=n}function m(e){var t=0;l(e,function(){return u(e,function(e){(e=e&&e.attrs)&&null==e.key&&(e.key="__mithril__"+t++)}),1})}function b(e,t,r){(e.tag!==t.tag||r.sort().join()!==Object.keys(t.attrs).sort().join()||e.attrs.id!==t.attrs.id||e.attrs.key!==t.attrs.key||"all"===c.redraw.strategy()&&(!t.configContext||t.configContext.retain!==!0)||"diff"===c.redraw.strategy()&&t.configContext&&t.configContext.retain===!1)&&(t.nodes.length&&U(t.nodes),t.configContext&&n(t.configContext.onunload)&&t.configContext.onunload(),t.controllers&&u(t.controllers,function(e){e.unload&&e.onunload({preventDefault:we})}))}function y(e,t){return e.attrs.xmlns?e.attrs.xmlns:"svg"===e.tag?"http://www.w3.org/2000/svg":"math"===e.tag?"http://www.w3.org/1998/Math/MathML":t}function w(e,t,n){n.length&&(e.views=t,e.controllers=n,u(n,function(e){if(e.onunload&&e.onunload.$old&&(e.onunload=e.onunload.$old),Ue&&e.onunload){var t=e.onunload;e.onunload=we,e.onunload.$old=t}}))}function k(e,t,r,o,a){if(n(t.attrs.config)){var i=a.configContext=a.configContext||{};e.push(function(){return t.attrs.config.call(t,r,!o,i,a)})}}function x(e,n,r,o,a,i,c,u){var l=e.nodes[0];return o&&I(l,n.tag,n.attrs,e.attrs,a),e.children=K(l,n.tag,t,t,n.children,e.children,!1,0,n.attrs.contenteditable?l:r,a,c),e.nodes.intact=!0,u.length&&(e.views=i,e.controllers=u),l}function C(e,t,n){var r;e.$trusted?r=$(t,n,e):(r=[se.createTextNode(e)],t.nodeName.match(ye)||p(t,r[0],n));var o="string"==typeof e||"number"==typeof e||"boolean"==typeof e?new e.constructor(e):e;return o.nodes=r,o}function P(e,t,n,r,o,a){var i=t.nodes;return r&&r===se.activeElement||(e.$trusted?(U(i,t),i=$(n,o,e)):"textarea"===a?n.value=e:r?r.innerHTML=e:((1===i[0].nodeType||i.length>1)&&(U(t.nodes,t),i=[se.createTextNode(e)]),d(n,i[0],o,e))),t=new e.constructor(e),t.nodes=i,t}function E(e,t,n,r,o,a,i){return 0===e.nodes.length?C(t,r,n):e.valueOf()!==t.valueOf()||o===!0?P(t,e,r,a,n,i):(e.nodes.intact=!0,e)}function M(e){if(e.$trusted){var t=e.match(/<[^\/]|\>\s*[^<]/g);if(null!=t)return t.length}else if(ve(e))return e.length;return 1}function O(e,n,r,o,a,i,c,u,s){e=f(e);var d=[],p=n.length===e.length,h=0,b={},y=!1;l(n,function(e,t){y=!0,b[n[t].attrs.key]={action:xe,index:t}}),m(e),y&&(n=v(e,n,b,r));for(var w=0,k=0,x=e.length;x>k;k++){var C=K(r,a,n,o,e[k],n[w],i,o+h||h,c,u,s);C!==t&&(p=p&&C.nodes.intact,h+=M(C),n[w++]=C)}return p||g(e,n,d),n}function A(e,t,n,r,o){if(null!=t){if(ge.call(t)===ge.call(e))return t;if(o&&o.nodes){var a=n-r,i=a+(ve(e)?e:t.nodes).length;U(o.nodes.slice(a,i),o.slice(a,i))}else t.nodes&&U(t.nodes,t)}return t=new e.constructor,t.tag&&(t={}),t.nodes=[],t}function T(e,n){return n===t?e.attrs.is?se.createElement(e.tag,e.attrs.is):se.createElement(e.tag):e.attrs.is?se.createElementNS(n,e.tag,e.attrs.is):se.createElementNS(n,e.tag)}function N(e,t,n,r){return r?I(t,e.tag,e.attrs,{},n):e.attrs}function j(e,n,r,o,a,i){return null!=e.children&&e.children.length>0?K(n,e.tag,t,t,e.children,r.children,!0,0,e.attrs.contenteditable?n:o,a,i):e.children}function S(e,t,n,r,o,a,i){var c={tag:e.tag,attrs:t,children:n,nodes:[r]};return w(c,a,i),c.children&&!c.children.nodes&&(c.children.nodes=[]),"select"===e.tag&&"value"in e.attrs&&I(r,e.tag,{value:e.attrs.value},{},o),c}function D(e,t,n,r){var o="diff"===c.redraw.strategy()&&e?e.indexOf(t):-1;return o>-1?n[o]:"function"==typeof r?new r:{}}function R(e,t,n,r){null!=r.onunload&&Fe.push({controller:r,handler:r.onunload}),e.push(n),t.push(r)}function q(e,t,n,r,o,a){var i=D(n.views,t,r,e.controller),c=+(e&&e.attrs&&e.attrs.key);return e=0===Ue||Ie||r&&r.indexOf(i)>-1?e.view(i):{tag:"placeholder"},"retain"===e.subtree?n:(c===c&&((e.attrs=e.attrs||{}).key=c),R(a,o,t,i),e)}function L(e,t,n,r){for(var o=t&&t.controllers;null!=e.view;)e=q(e,e.view.$original||e.view,t,o,r,n);return e}function F(e,t,n,r,a,i,c,u){var l=[],s=[];if(e=L(e,t,l,s),!e.tag&&s.length)throw new Error("Component template must return a virtual element, not an array, string, etc.");e.attrs=e.attrs||{},t.attrs=t.attrs||{};var d=Object.keys(e.attrs),f=d.length>("key"in e.attrs?1:0);if(b(e,t,d),o(e.tag)){var h=0===t.nodes.length;c=y(e,c);var v;if(h){v=T(e,c);var g=N(e,v,c,f),m=j(e,v,t,n,c,u);t=S(e,g,m,v,c,l,s)}else v=x(t,e,n,f,c,l,u,s);return(h||i===!0&&null!=v)&&p(r,v,a),k(u,e,v,h,t),t}}function K(e,t,o,a,i,c,u,l,d,f,p){return i=s(i),"retain"===i.subtree?c:(c=A(i,c,l,a,o),ve(i)?O(i,c,e,l,t,u,d,f,p):null!=i&&r(i)?F(i,c,d,e,l,u,f,p):n(i)?c:E(c,i,l,e,u,d,t))}function B(e,t){return e.action-t.action||e.index-t.index}function I(e,t,o,a,i){for(var c in o){var u=o[c],l=a[c];if(c in a&&l===u)"value"===c&&"input"===t&&e.value!=u&&(e.value=u);else{if(a[c]=u,"config"===c||"key"===c)continue;if(n(u)&&"on"===c.slice(0,2))e[c]=X(u,e);else if("style"===c&&null!=u&&r(u)){for(var s in u)(null==l||l[s]!==u[s])&&(e.style[s]=u[s]);for(var s in l)s in u||(e.style[s]="")}else null!=i?"href"===c?e.setAttributeNS("http://www.w3.org/1999/xlink","href",u):e.setAttribute("className"===c?"class":c,u):c in e&&"list"!==c&&"style"!==c&&"form"!==c&&"type"!==c&&"width"!==c&&"height"!==c?("input"!==t||e[c]!==u)&&(e[c]=u):e.setAttribute(c,u)}}return a}function U(e,t){for(var n=e.length-1;n>-1;n--)if(e[n]&&e[n].parentNode){try{e[n].parentNode.removeChild(e[n])}catch(r){}t=[].concat(t),t[n]&&z(t[n])}e.length&&(e.length=0)}function z(e){e.configContext&&n(e.configContext.onunload)&&(e.configContext.onunload(),e.configContext.onunload=null),e.controllers&&u(e.controllers,function(e){n(e.onunload)&&e.onunload({preventDefault:we})}),e.children&&(ve(e.children)?u(e.children,z):e.children.tag&&z(e.children))}function $(e,t,n){var r=e.childNodes[t];if(r){var o=1!==r.nodeType,a=se.createElement("span");o?(e.insertBefore(a,r||null),a.insertAdjacentHTML("beforebegin",n),e.removeChild(a)):r.insertAdjacentHTML("beforebegin",n)}else Ee(e,n);for(var i=[];e.childNodes[t]!==r;)i.push(e.childNodes[t]),t++;return i}function X(e,t){return function(n){n=n||event,c.redraw.strategy("diff"),c.startComputation();try{return e.call(t,n)}finally{Y()}}}function G(e){var t=Oe.indexOf(e);return 0>t?Oe.push(e)-1:t}function H(e){var t=function(){return arguments.length&&(e=arguments[0]),e};return t.toJSON=function(){return e},t}function W(e,t){var n=function(){return(e.controller||we).apply(this,t)||this};e.controller&&(n.prototype=e.controller.prototype);var r=function(n){var r=arguments.length>1?t.concat([].slice.call(arguments,1)):t;return e.view.apply(e,r?[n].concat(r):[n])};r.$original=e.view;var o={controller:n,view:r};return t[0]&&null!=t[0].key&&(o.attrs={key:t[0].key}),o}function _(e,t){Ne.splice(t,1),Se.splice(t,1),je.splice(t,1),re(e),Oe.splice(G(e),1)}function J(){qe&&(qe(),qe=null),u(Ne,function(e,t){var n=je[t];if(Se[t]){var r=[Se[t]];c.render(e,n.view?n.view(Se[t],r):"")}}),Le&&(Le(),Le=null),De=null,Re=new Date,c.redraw.strategy("diff")}function Y(){"none"===c.redraw.strategy()?(Ue--,c.redraw.strategy("diff")):c.endComputation()}function V(e){return e.slice(Xe[c.route.mode].length)}function Q(e,t,n){ze={};var r=n.indexOf("?");-1!==r&&(ze=ne(n.substr(r+1,n.length)),n=n.substr(0,r));var o=Object.keys(t),a=o.indexOf(n);if(-1!==a)return c.mount(e,t[o[a]]),!0;for(var i in t){if(i===n)return c.mount(e,t[i]),!0;var l=new RegExp("^"+i.replace(/:[^\/]+?\.{3}/g,"(.*?)").replace(/:[^\/]+/g,"([^\\/]+)")+"/?$");if(l.test(n))return n.replace(l,function(){var n=i.match(/:[^\/]+/g)||[],r=[].slice.call(arguments,1,-2);u(n,function(e,t){ze[e.replace(/:|\./g,"")]=decodeURIComponent(r[t])}),c.mount(e,t[i])}),!0}}function Z(e){if(e=e||event,!e.ctrlKey&&!e.metaKey&&2!==e.which){e.preventDefault?e.preventDefault():e.returnValue=!1;for(var t=e.currentTarget||e.srcElement,n="pathname"===c.route.mode&&t.search?ne(t.search.slice(1)):{};t&&"A"!==t.nodeName.toUpperCase();)t=t.parentNode;c.route(t[c.route.mode].slice(Xe[c.route.mode].length),n)}}function ee(){"hash"!==c.route.mode&&de.hash?de.hash=de.hash:e.scrollTo(0,0)}function te(e,n){var o={},a=[];for(var i in e){var c=n?n+"["+i+"]":i,l=e[i];if(null===l)a.push(encodeURIComponent(c));else if(r(l))a.push(te(l,c));else if(ve(l)){var s=[];o[c]=o[c]||{},u(l,function(e){o[c][e]||(o[c][e]=!0,s.push(encodeURIComponent(c)+"="+encodeURIComponent(e)))}),a.push(s.join("&"))}else l!==t&&a.push(encodeURIComponent(c)+"="+encodeURIComponent(l))}return a.join("&")}function ne(e){if(""===e||null==e)return{};"?"===e.charAt(0)&&(e=e.slice(1));var t=e.split("&"),n={};return u(t,function(e){var t=e.split("="),r=decodeURIComponent(t[0]),o=2===t.length?decodeURIComponent(t[1]):null;null!=n[r]?(ve(n[r])||(n[r]=[n[r]]),n[r].push(o)):n[r]=o}),n}function re(e){var n=G(e);U(e.childNodes,Ae[n]),Ae[n]=t}function oe(e,t){var n=c.prop(t);return e.then(n),n.then=function(n,r){return oe(e.then(n,r),t)},n["catch"]=n.then.bind(null,null),n["finally"]=function(e){var r=function(){return c.deferred().resolve(e()).promise};return n.then(function(e){return oe(r().then(function(){return e}),t)},function(e){return oe(r().then(function(){throw new Error(e)}),t)})},n}function ae(e,t){function o(e){p=e||d,v.map(function(e){p===s?e.resolve(h):e.reject(h)})}function a(e,t,o,a){if((null!=h&&r(h)||n(h))&&n(e))try{var i=0;e.call(h,function(e){i++||(h=e,t())},function(e){i++||(h=e,o())})}catch(u){c.deferred.onerror(u),h=u,o()}else a()}function i(){var r;try{r=h&&h.then}catch(d){return c.deferred.onerror(d),h=d,p=l,i()}a(r,function(){p=u,i()},function(){p=l,i()},function(){try{p===u&&n(e)?h=e(h):p===l&&n(t)&&(h=t(h),p=u)}catch(i){return c.deferred.onerror(i),h=i,o()}h===f?(h=TypeError(),o()):a(r,function(){o(s)},o,function(){o(p===u&&s)})})}var u=1,l=2,s=3,d=4,f=this,p=0,h=0,v=[];f.promise={},f.resolve=function(e){return p||(h=e,p=u,i()),this},f.reject=function(e){return p||(h=e,p=l,i()),this},f.promise.then=function(e,t){var n=new ae(e,t);return p===s?n.resolve(h):p===d?n.reject(h):v.push(n),n.promise}}function ie(e){return e}function ce(r){if(!r.dataType||"jsonp"!==r.dataType.toLowerCase()){var a=new e.XMLHttpRequest;if(a.open(r.method,r.url,!0,r.user,r.password),a.onreadystatechange=function(){4===a.readyState&&(a.status>=200&&a.status<300?r.onload({type:"load",target:a}):r.onerror({type:"error",target:a}))},r.serialize===JSON.stringify&&r.data&&"GET"!==r.method&&a.setRequestHeader("Content-Type","application/json; charset=utf-8"),r.deserialize===JSON.parse&&a.setRequestHeader("Accept","application/json, text/*"),n(r.config)){var i=r.config(a,r);null!=i&&(a=i)}var c="GET"!==r.method&&r.data?r.data:"";if(c&&!o(c)&&c.constructor!==e.FormData)throw new Error("Request data should be either be a string or FormData. Check the `serialize` option in `m.request`");return a.send(c),a}var u="mithril_callback_"+(new Date).getTime()+"_"+Math.round(1e16*Math.random()).toString(36),l=se.createElement("script");e[u]=function(n){l.parentNode.removeChild(l),r.onload({type:"load",target:{responseText:n}}),e[u]=t},l.onerror=function(){return l.parentNode.removeChild(l),r.onerror({type:"error",target:{status:500,responseText:JSON.stringify({error:"Error making jsonp request"})}}),e[u]=t,!1},l.onload=function(){return!1},l.src=r.url+(r.url.indexOf("?")>0?"&":"?")+(r.callbackKey?r.callbackKey:"callback")+"="+u+"&"+te(r.data||{}),se.body.appendChild(l)}function ue(e,t,n){if("GET"===e.method&&"jsonp"!==e.dataType){var r=e.url.indexOf("?")<0?"?":"&",o=te(t);e.url=e.url+(o?r+o:"")}else e.data=n(t);return e}function le(e,t){var n=e.match(/:[a-z]\w+/gi);return n&&t&&u(n,function(n){var r=n.slice(1);e=e.replace(n,t[r]),delete t[r]}),e}var se,de,fe,pe,he="v0.2.1",ve=Array.isArray||function(e){return"[object Array]"===ge.call(e)},ge={}.toString,me=/(?:(^|#|\.)([^#\.\[\]]+))|(\[.+?\])/g,be=/\[(.+?)(?:=("|'|)(.*?)\2)?\]/,ye=/^(AREA|BASE|BR|COL|COMMAND|EMBED|HR|IMG|INPUT|KEYGEN|LINK|META|PARAM|SOURCE|TRACK|WBR)$/,we=function(){};i(e),c.version=function(){return he};var ke,xe=1,Ce=2,Pe=3,Ee=function(){var e=function(e,t){e.appendChild(se.createRange().createContextualFragment(t))},t=function(e,t){e.insertAdjacentHTML("beforeend",t)};try{return se.createRange().createContextualFragment("x"),e}catch(n){return t}}(),Me={appendChild:function(e){ke===t&&(ke=se.createElement("html")),se.documentElement&&se.documentElement!==e?se.replaceChild(e,se.documentElement):se.appendChild(e),this.childNodes=se.childNodes},insertBefore:function(e){this.appendChild(e)},childNodes:[]},Oe=[],Ae={};c.render=function(e,n,r){var o=[];if(!e)throw new Error("Ensure the DOM element being passed to m.route/m.mount/m.render is not undefined.");var a=G(e),i=e===se,c=i||e===se.documentElement?Me:e;i&&"html"!==n.tag&&(n={tag:"html",attrs:{},children:n}),Ae[a]===t&&U(c.childNodes),r===!0&&re(e),Ae[a]=K(c,null,t,t,n,Ae[a],!1,0,null,t,o),u(o,function(e){e()})},c.trust=function(e){return e=new String(e),e.$trusted=!0,e},c.prop=function(e){return(null!=e&&r(e)||n(e))&&n(e.then)?oe(e):H(e)};var Te,Ne=[],je=[],Se=[],De=null,Re=0,qe=null,Le=null,Fe=[],Ke=16;c.component=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);return W(e,t)},c.mount=c.module=function(e,t){if(!e)throw new Error("Please ensure the DOM element exists before rendering a template into it.");var r=Ne.indexOf(e);0>r&&(r=Ne.length);var o=!1,a={preventDefault:function(){o=!0,qe=Le=null}};u(Fe,function(e){e.handler.call(e.controller,a),e.controller.onunload=null}),o?u(Fe,function(e){e.controller.onunload=e.handler}):Fe=[],Se[r]&&n(Se[r].onunload)&&Se[r].onunload(a);var i=null===t;if(!o){c.redraw.strategy("all"),c.startComputation(),Ne[r]=e;var l=Te=t?t:t={controller:we},s=new(t.controller||we);return l===Te&&(Se[r]=s,je[r]=t),Y(),i&&_(e,r),Se[r]}i&&_(e,r)};var Be=!1,Ie=!1;c.redraw=function(t){if(!Be){Be=!0,t&&(Ie=!0);try{De&&!t?(fe===e.requestAnimationFrame||new Date-Re>Ke)&&(De>0&&pe(De),De=fe(J,Ke)):(J(),De=fe(function(){De=null},Ke))}finally{Be=Ie=!1}}},c.redraw.strategy=c.prop();var Ue=0;c.startComputation=function(){Ue++},c.endComputation=function(){Ue>1?Ue--:(Ue=0,c.redraw())},c.withAttr=function(e,t,n){return function(r){r=r||event;var o=r.currentTarget||this,a=n||this;t.call(a,e in o?o[e]:o.getAttribute(e))}};var ze,$e,Xe={pathname:"",hash:"#",search:"?"},Ge=we,He=!1;return c.route=function(t,n,r,a){if(0===arguments.length)return $e;if(3===arguments.length&&o(n)){Ge=function(e){var o=$e=V(e);if(!Q(t,r,o)){if(He)throw new Error("Ensure the default route matches one of the routes defined in m.route");He=!0,c.route(n,!0),He=!1}};var i="hash"===c.route.mode?"onhashchange":"onpopstate";e[i]=function(){var e=de[c.route.mode];"pathname"===c.route.mode&&(e+=de.search),$e!==V(e)&&Ge(e)},qe=ee,e[i]()}else if(t.addEventListener||t.attachEvent)t.href=("pathname"!==c.route.mode?de.pathname:"")+Xe[c.route.mode]+a.attrs.href,t.addEventListener?(t.removeEventListener("click",Z),t.addEventListener("click",Z)):(t.detachEvent("onclick",Z),t.attachEvent("onclick",Z));else if(o(t)){var u=$e;$e=t;var l=n||{},s=$e.indexOf("?"),d=s>-1?ne($e.slice(s+1)):{};for(var f in l)d[f]=l[f];var p=te(d),h=s>-1?$e.slice(0,s):$e;p&&($e=h+(-1===h.indexOf("?")?"?":"&")+p);var v=(3===arguments.length?r:n)===!0||u===t;e.history.pushState?(qe=ee,Le=function(){e.history[v?"replaceState":"pushState"](null,se.title,Xe[c.route.mode]+$e)},Ge(Xe[c.route.mode]+$e)):(de[c.route.mode]=$e,Ge(Xe[c.route.mode]+$e))}},c.route.param=function(e){if(!ze)throw new Error("You must call m.route(element, defaultRoute, routes) before calling m.route.param()");return e?ze[e]:ze},c.route.mode="search",c.route.buildQueryString=te,c.route.parseQueryString=ne,c.deferred=function(){var e=new ae;return e.promise=oe(e.promise),e},c.deferred.onerror=function(e){if("[object Error]"===ge.call(e)&&!e.constructor.toString().match(/ Error/))throw Ue=0,e},c.sync=function(e){function t(e,t){return function(i){return a[e]=i,t||(n="reject"),0===--o&&(r.promise(a),r[n](a)),i}}var n="resolve",r=c.deferred(),o=e.length,a=new Array(o);return e.length>0?u(e,function(e,n){e.then(t(n,!0),t(n,!1))}):r.resolve([]),r.promise},c.request=function(e){e.background!==!0&&c.startComputation();var t=new ae,n=e.dataType&&"jsonp"===e.dataType.toLowerCase(),r=e.serialize=n?ie:e.serialize||JSON.stringify,o=e.deserialize=n?ie:e.deserialize||JSON.parse,a=n?function(e){return e.responseText}:e.extract||function(e){return 0===e.responseText.length&&o===JSON.parse?null:e.responseText};return e.method=(e.method||"GET").toUpperCase(),e.url=le(e.url,e.data),e=ue(e,e.data,r),e.onload=e.onerror=function(n){try{n=n||event;var r=("load"===n.type?e.unwrapSuccess:e.unwrapError)||ie,i=r(o(a(n.target,e)),n.target);"load"===n.type&&(ve(i)&&e.type?u(i,function(t,n){i[n]=new e.type(t)}):e.type&&(i=new e.type(i))),t["load"===n.type?"resolve":"reject"](i)}catch(n){c.deferred.onerror(n),t.reject(n)}e.background!==!0&&c.endComputation()},ce(e),t.promise=oe(t.promise,e.initialValue),t.promise},c.deps=function(t){return i(e=t||e),e},c.deps.factory=a,c}("undefined"!=typeof window?window:{});"object"==typeof n&&null!=n&&n.exports?n.exports=o:"function"==typeof e&&e.amd&&e(function(){return o})},{}],4:[function(e,t,n){function r(e,t,n){var r=n?s.invertKey(e):e;return{key:r,pos:s.key2pos(r),role:t.role,color:t.color}}function o(e,t){return e.role===t.role&&e.color===t.color}function a(e,t){return t.sort(function(t,n){return s.distance(e.pos,t.pos)-s.distance(e.pos,n.pos)})[0]}function i(e,t){var n=t.bounds(),i=n.width/8,c=n.height/8,u={},l=[],d=[],f=[],p=[],h=e.orientation!==t.orientation,v={},g="white"===t.orientation;for(var m in e.pieces){var b=r(m,e.pieces[m],h);v[b.key]=b}for(var y=0;y<s.allKeys.length;y++){var w=s.allKeys[y];if(w!==t.movable.dropped[1]){var k=t.pieces[w],x=v[w];k?x?o(k,x)||(f.push(x),p.push(r(w,k,!1))):p.push(r(w,k,!1)):x&&f.push(x)}}return p.forEach(function(e){var t=a(e,f.filter(s.partial(o,e)));if(t){var n=g?t.pos:e.pos,r=g?e.pos:t.pos,d=[(n[0]-r[0])*i,(r[1]-n[1])*c];u[e.key]=[d,d],l.push(t.key)}}),f.forEach(function(e){e.key===t.movable.dropped[0]||s.containsX(l,e.key)||d.push({piece:{role:e.role,color:e.color},left:12.5*(g?e.pos[0]-1:8-e.pos[0])+"%",bottom:12.5*(g?e.pos[1]-1:8-e.pos[1])+"%",opacity:1})}),{anims:u,fadings:d}}function c(e,t){return Math.round(e*t)/t}function u(e){if(e.animation.current.start){var t=1-((new Date).getTime()-e.animation.current.start)/e.animation.current.duration;if(0>=t)e.animation.current={},e.render();else{var n=d.easeInOutCubic(t);for(var r in e.animation.current.anims){var o=e.animation.current.anims[r];o[1]=[c(o[0][0]*n,10),c(o[0][1]*n,10)]}for(var a in e.animation.current.fadings)e.animation.current.fadings[a].opacity=c(n,100);e.render(),s.requestAnimationFrame(function(){u(e)})}}}function l(e,t){var n={orientation:t.orientation,pieces:{}};for(var r in t.pieces)n.pieces[r]={role:t.pieces[r].role,color:t.pieces[r].color};var o=e(),a=i(n,t);if(Object.keys(a.anims).length>0||a.fadings.length>0){var c=t.animation.current.start;t.animation.current={start:(new Date).getTime(),duration:t.animation.duration,anims:a.anims,fadings:a.fadings},c||u(t)}else t.renderRAF();return o}var s=e("./util"),d={easeInOutCubic:function(e){return.5>e?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}};t.exports=function(e,t,n){return function(){var r=[t].concat(Array.prototype.slice.call(arguments,0));if(t.render){if(t.animation.enabled&&!n)return l(s.partialApply(e,r),t);var o=e.apply(null,r);return t.renderRAF(),o}return e.apply(null,r)}}},{"./util":16}],5:[function(e,t,n){var r=e("./board");t.exports=function(e){return{set:e.set,toggleOrientation:e.toggleOrientation,getOrientation:e.getOrientation,getPieces:function(){return e.data.pieces},getMaterialDiff:function(){return r.getMaterialDiff(e.data)},getFen:e.getFen,dump:function(){return e.data},move:e.apiMove,newPiece:e.apiNewPiece,setPieces:e.setPieces,setCheck:e.setCheck,playPremove:e.playPremove,playPredrop:e.playPredrop,cancelPremove:e.cancelPremove,cancelPredrop:e.cancelPredrop,cancelMove:e.cancelMove,stop:e.stop,explode:e.explode,setAutoShapes:e.setAutoShapes,setShapes:e.setShapes,data:e.data}}},{"./board":6}],6:[function(e,t,n){function r(e){setTimeout(e,1)}function o(e){e.orientation=L.opposite(e.orientation)}function a(e){e.lastMove=null,k(e,null),l(e),d(e)}function i(e,t){Object.keys(t).forEach(function(n){t[n]?e.pieces[n]=t[n]:delete e.pieces[n]}),e.movable.dropped=[]}function c(e,t){var n=t||e.turnColor;Object.keys(e.pieces).forEach(function(t){e.pieces[t].color===n&&"king"===e.pieces[t].role&&(e.check=t)})}function u(e,t,n){d(e),e.premovable.current=[t,n],r(L.partial(e.premovable.events.set,t,n))}function l(e){e.premovable.current&&(e.premovable.current=null,r(e.premovable.events.unset))}function s(e,t,n){l(e),e.predroppable.current={role:t,key:n},r(L.partial(e.predroppable.events.set,t,n))}function d(e){e.predroppable.current.key&&(e.predroppable.current={},r(e.predroppable.events.unset))}function f(e,t,n){if(e.autoCastle){var r=e.pieces[n];if("king"===r.role){var o=L.key2pos(t);if(5===o[0]&&(1===o[1]||8===o[1])){var a,i,c,u=L.key2pos(n);if(7===u[0]||8===u[0])a=L.pos2key([8,o[1]]),i=L.pos2key([6,o[1]]),c=L.pos2key([7,o[1]]);else{if(3!==u[0]&&1!==u[0])return;a=L.pos2key([1,o[1]]),i=L.pos2key([4,o[1]]),c=L.pos2key([3,o[1]])}delete e.pieces[t],delete e.pieces[n],delete e.pieces[a],e.pieces[c]={role:"king",color:r.color},e.pieces[i]={role:"rook",color:r.color}}}}}function p(e,t,n){var o=K(function(){if(t===n||!e.pieces[t])return!1;var o=e.pieces[n]&&e.pieces[n].color!==e.pieces[t].color?e.pieces[n]:null;return r(L.partial(e.events.move,t,n,o)),e.pieces[n]=e.pieces[t],delete e.pieces[t],e.lastMove=[t,n],e.check=null,f(e,t,n),r(e.events.change),!0},e)();return o&&(e.movable.dropped=[]),o}function h(e,t,n){return e.pieces[n]?!1:(r(L.partial(e.events.dropNewPiece,t,n)),e.pieces[n]=t,e.lastMove=[n,n],e.check=null,r(e.events.change),e.movable.dropped=[],e.movable.dests={},e.turnColor=L.opposite(e.turnColor),e.renderRAF(),!0)}function v(e,t,n){var r=p(e,t,n);return r&&(e.movable.dests={},e.turnColor=L.opposite(e.turnColor)),r}function g(e,t,n){return p(e,t,n)}function m(e,t,n){return h(e,t,n)}function b(e,t,n){if(n)if(C(e,t,n)){if(v(e,t,n)){var o=B.stop();return k(e,null),r(L.partial(e.movable.events.after,t,n,{premove:!1,holdTime:o})),!0}}else M(e,t,n)?(u(e,t,n),k(e,null)):x(e,n)||E(e,n)?(k(e,n),B.start()):k(e,null);else B.cancel(),k(e,null),"trash"===e.movable.dropOff&&(delete e.pieces[t],r(e.events.change))}function y(e,t,n){if(P(e,t,n)){var o=e.pieces[t];delete e.pieces[t],h(e,o,n),e.movable.dropped=[],r(L.partial(e.movable.events.afterNewPiece,o.role,n,{predrop:!1}))}else O(e,t,n)?s(e,e.pieces[t].role,n):(l(e),d(e));delete e.pieces[t],k(e,null)}function w(e,t){e.selected?t?e.selectable.enabled&&e.selected!==t?b(e,e.selected,t)&&(e.stats.dragged=!1):B.start():(k(e,null),B.cancel()):(x(e,t)||E(e,t))&&(k(e,t),B.start()),t&&r(L.partial(e.events.select,t))}function k(e,t){e.selected=t,e.premovable.dests=t&&E(e,t)?F(e.pieces,t,e.premovable.castle):null}function x(e,t){var n=e.pieces[t];return n&&("both"===e.movable.color||e.movable.color===n.color&&e.turnColor===n.color)}function C(e,t,n){return t!==n&&x(e,t)&&(e.movable.free||L.containsX(e.movable.dests[t],n))}function P(e,t,n){var r=e.pieces[t];return r&&n&&(t===n||!e.pieces[n])&&("both"===e.movable.color||e.movable.color===r.color&&e.turnColor===r.color)}function E(e,t){var n=e.pieces[t];return n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}function M(e,t,n){return t!==n&&E(e,t)&&L.containsX(F(e.pieces,t,e.premovable.castle),n)}function O(e,t,n){var r=e.pieces[t];return r&&n&&(!e.pieces[n]||e.pieces[n].color!==e.movable.color)&&e.predroppable.enabled&&("pawn"!==r.role||"1"!==n[1]&&"8"!==n[1])&&e.movable.color===r.color&&e.turnColor!==r.color}function A(e,t){var n=e.pieces[t];return n&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}function T(e){var t=e.premovable.current;if(t){var n=t[0],o=t[1],a=!1;return C(e,n,o)&&v(e,n,o)&&(r(L.partial(e.movable.events.after,n,o,{premove:!0})),a=!0),l(e),a}}function N(e,t){var n=e.predroppable.current,o=!1;if(n.key){if(t(n)){var a={role:n.role,color:e.movable.color};h(e,a,n.key)&&(r(L.partial(e.movable.events.afterNewPiece,n.role,n.key,{predrop:!0})),o=!0)}return d(e),o}}function j(e){l(e),d(e),w(e,null)}function S(e){e.movable.color=null,e.movable.dests={},j(e)}function D(e,t,n){if(n||e.bounds){n=n||e.bounds();var r=Math.ceil(8*((t[0]-n.left)/n.width));r="white"===e.orientation?r:9-r;var o=Math.ceil(8-8*((t[1]-n.top)/n.height));return o="white"===e.orientation?o:9-o,r>0&&9>r&&o>0&&9>o?L.pos2key([r,o]):void 0}}function R(e){var t={king:0,queen:0,rook:0,bishop:0,knight:0,pawn:0};for(var n in e.pieces){var r=e.pieces[n];t[r.role]+="white"===r.color?1:-1}var o={white:{},black:{}};for(var a in t){var i=t[a];i>0?o.white[a]=i:0>i&&(o.black[a]=-i)}return o}function q(e){var t=0;for(var n in e.pieces)t+=I[e.pieces[n].role]*("white"===e.pieces[n].color?1:-1);return t}var L=e("./util"),F=e("./premove"),K=e("./anim"),B=e("./hold"),I={pawn:1,knight:3,bishop:3,rook:5,queen:9,king:0};t.exports={reset:a,toggleOrientation:o,setPieces:i,setCheck:c,selectSquare:w,setSelected:k,isDraggable:A,canMove:C,userMove:b,dropNewPiece:y,apiMove:g,apiNewPiece:m,playPremove:T,playPredrop:N,unsetPremove:l,unsetPredrop:d,cancelMove:j,stop:S,getKeyAtDomPos:D,getMaterialDiff:R,getScore:q}},{"./anim":4,"./hold":13,"./premove":14,"./util":16}],7:[function(e,t,n){var r=e("merge"),o=e("./board"),a=e("./fen");t.exports=function(e,t){t&&(t.movable&&t.movable.dests&&delete e.movable.dests,r.recursive(e,t),e.fen&&(e.pieces=a.read(e.fen),e.check=t.check,e.drawable.shapes=[],delete e.fen),e.check===!0&&o.setCheck(e),e.movable.dropped=[],e.selected&&o.setSelected(e,e.selected),(!e.animation.duration||e.animation.duration<10)&&(e.animation.enabled=!1))}},{"./board":6,"./fen":12,merge:2}],8:[function(e,t,n){var r=e("./board"),o=e("./data"),a=e("./fen"),i=e("./configure"),c=e("./anim"),u=e("./drag");t.exports=function(e){this.data=o(e),this.vm={exploding:!1},this.getFen=function(){return a.write(this.data.pieces)}.bind(this),this.getOrientation=function(){return this.data.orientation}.bind(this),this.set=c(i,this.data),this.toggleOrientation=c(r.toggleOrientation,this.data),this.setPieces=c(r.setPieces,this.data),this.selectSquare=c(r.selectSquare,this.data,!0),this.apiMove=c(r.apiMove,this.data),this.apiNewPiece=c(r.apiNewPiece,this.data),this.playPremove=c(r.playPremove,this.data),this.playPredrop=c(r.playPredrop,this.data),this.cancelPremove=c(r.unsetPremove,this.data,!0),this.cancelPredrop=c(r.unsetPredrop,this.data,!0),this.setCheck=c(r.setCheck,this.data,!0),this.cancelMove=c(function(e){r.cancelMove(e),u.cancel(e)}.bind(this),this.data,!0),this.stop=c(function(e){r.stop(e),u.cancel(e)}.bind(this),this.data,!0),this.explode=function(e){this.data.render&&(this.vm.exploding={stage:1,keys:e},this.data.renderRAF(),setTimeout(function(){this.vm.exploding.stage=2,this.data.renderRAF(),setTimeout(function(){this.vm.exploding=!1,this.data.renderRAF()}.bind(this),120)}.bind(this),120))}.bind(this),this.setAutoShapes=function(e){c(function(t){t.drawable.autoShapes=e},this.data,!1)()}.bind(this),this.setShapes=function(e){c(function(t){t.drawable.shapes=e},this.data,!1)()}.bind(this)}},{"./anim":4,"./board":6,"./configure":7,"./data":9,"./drag":10,"./fen":12}],9:[function(e,t,n){var r=e("./fen"),o=e("./configure");t.exports=function(e){var t={pieces:r.read(r.initial),orientation:"white",turnColor:"white",check:null,lastMove:null,selected:null,coordinates:!0,render:null,renderRAF:null,element:null,bounds:null,autoCastle:!1,viewOnly:!1,minimalDom:!1,disableContextMenu:!1,resizable:!0,
highlight:{lastMove:!0,check:!0,dragOver:!0},animation:{enabled:!0,duration:200,current:{}},movable:{free:!0,color:"both",dests:{},dropOff:"revert",dropped:[],showDests:!0,events:{after:function(e,t,n){},afterNewPiece:function(e,t){}}},premovable:{enabled:!0,showDests:!0,castle:!0,dests:[],current:null,events:{set:function(e,t){},unset:function(){}}},predroppable:{enabled:!1,current:{},events:{set:function(e,t){},unset:function(){}}},draggable:{enabled:!0,distance:3,autoDistance:!0,centerPiece:!0,showGhost:!0,current:{}},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{change:function(){},move:function(e,t,n){},dropNewPiece:function(e,t){},capture:function(e,t){},select:function(e){}},drawable:{enabled:!1,eraseOnClick:!0,onChange:function(e){},shapes:[],autoShapes:[],current:{},brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10,circleMargin:0},red:{key:"r",color:"#882020",opacity:1,lineWidth:10,circleMargin:1},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10,circleMargin:2},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10,circleMargin:3},paleBlue:{key:"pb",color:"#003088",opacity:.3,lineWidth:15,circleMargin:0},paleGreen:{key:"pg",color:"#15781B",opacity:.35,lineWidth:15,circleMargin:0}}}};return o(t,e||{}),t}},{"./configure":7,"./fen":12}],10:[function(e,t,n){function r(e){return e?e.color+e.role:""}function o(e,t,n){var r=f.key2pos(n);return"white"!==e.orientation&&(r[0]=9-r[0],r[1]=9-r[1]),{left:t.left+t.width*(r[0]-1)/8,top:t.top+t.height*(8-r[1])/8,width:t.width/8,height:t.height/8}}function a(e,t){if(!(void 0!==t.button&&0!==t.button||t.touches&&t.touches.length>1)){t.stopPropagation(),t.preventDefault(),s=t.target;var n=e.selected,a=f.eventPosition(t),c=e.bounds(),u=d.getKeyAtDomPos(e,a,c),l=!!e.premovable.current,h=!!e.predroppable.current.key;d.selectSquare(e,u);var v=e.selected===u,g=e.pieces[u];if(n||!e.drawable.eraseOnClick&&g&&g.color===e.turnColor||p.clear(e),g&&v&&d.isDraggable(e,u)){var m=o(e,c,u);e.draggable.current={previouslySelected:n,orig:u,piece:r(g),rel:a,epos:a,pos:[0,0],dec:e.draggable.centerPiece?[a[0]-(m.left+m.width/2),a[1]-(m.top+m.height/2)]:[0,0],bounds:c,started:e.draggable.autoDistance&&e.stats.dragged}}else l&&d.unsetPremove(e),h&&d.unsetPredrop(e);i(e)}}function i(e){f.requestAnimationFrame(function(){var t=e.draggable.current;t.orig&&(e.animation.current.start&&e.animation.current.anims[t.orig]&&(e.animation.current={}),r(e.pieces[t.orig])!==t.piece?l(e):(!t.started&&f.distance(t.epos,t.rel)>=e.draggable.distance&&(t.started=!0),t.started&&(t.pos=[t.epos[0]-t.rel[0],t.epos[1]-t.rel[1]],t.over=d.getKeyAtDomPos(e,t.epos,t.bounds)))),e.render(),t.orig&&i(e)})}function c(e,t){t.touches&&t.touches.length>1||e.draggable.current.orig&&(e.draggable.current.epos=f.eventPosition(t))}function u(e,t){var n=e.draggable,r=n.current?n.current.orig:null;if(r){if(t&&"touchend"===t.type&&s!==t.target&&!n.current.newPiece)return void(n.current={});d.unsetPremove(e),d.unsetPredrop(e);var o=n.current.over;n.current.started&&(n.current.newPiece?d.dropNewPiece(e,r,o):(r!==o&&(e.movable.dropped=[r,o]),d.userMove(e,r,o)&&(e.stats.dragged=!0))),r!==n.current.previouslySelected||r!==o&&o?e.selectable.enabled||d.setSelected(e,null):d.setSelected(e,null),n.current={}}}function l(e){e.draggable.current.orig&&(e.draggable.current={},d.selectSquare(e,null))}var s,d=e("./board"),f=e("./util"),p=e("./draw");t.exports={start:a,move:c,end:u,cancel:l,processDrag:i}},{"./board":6,"./draw":11,"./util":16}],11:[function(e,t,n){function r(e,t){if(!(t.touches&&t.touches.length>1)){t.stopPropagation(),t.preventDefault(),p.cancelMove(e);var n=h.eventPosition(t),r=e.bounds(),a=p.getKeyAtDomPos(e,n,r);e.drawable.current={orig:a,epos:n,bounds:r,brush:v[(t.shiftKey&h.isRightButton(t))+(t.altKey?2:0)]},o(e)}}function o(e){h.requestAnimationFrame(function(){var t=e.drawable.current;if(t.orig){var n=p.getKeyAtDomPos(e,t.epos,t.bounds);t.dest=t.orig===n?void 0:n}e.render(),t.orig&&o(e)})}function a(e,t){e.drawable.current.orig&&(e.drawable.current.epos=h.eventPosition(t))}function i(e,t){var n=e.drawable,r=n.current.orig,o=n.current.dest;r&&o?d(n,r,o):r&&s(n,r),n.current={},e.render()}function c(e){e.drawable.current.orig&&(e.drawable.current={})}function u(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.render(),f(e.drawable))}function l(e){return function(t){return!e(t)}}function s(e,t){var n=e.current.brush,r=function(e){return e.brush===n&&e.orig===t&&!e.dest},o=e.shapes.filter(r).length>0;o?e.shapes=e.shapes.filter(l(r)):e.shapes.push({brush:n,orig:t}),f(e)}function d(e,t,n){var r=e.current.brush,o=function(e){return e.orig&&e.dest&&(e.orig===t&&e.dest===n||e.dest===t&&e.orig===n)},a=e.shapes.filter(o).length>0;a?e.shapes=e.shapes.filter(l(o)):e.shapes.push({brush:r,orig:t,dest:n}),f(e)}function f(e){e.onChange(e.shapes)}var p=e("./board"),h=e("./util"),v=["green","red","blue","yellow"];t.exports={start:r,move:a,end:i,cancel:c,clear:u,processDraw:o}},{"./board":6,"./util":16}],12:[function(e,t,n){function r(e){"start"===e&&(e=i);var t={};return e.replace(/ .+$/,"").replace(/~/g,"").split("/").forEach(function(e,n){var r=0;e.split("").forEach(function(e){var o=parseInt(e);o?r+=o:(r++,t[a.pos2key([r,8-n])]={role:c[e.toLowerCase()],color:e===e.toLowerCase()?"black":"white"})})}),t}function o(e){return[8,7,6,5,4,3,2].reduce(function(e,t){return e.replace(new RegExp(Array(t+1).join("1"),"g"),t)},a.invRanks.map(function(t){return a.ranks.map(function(n){var r=e[a.pos2key([n,t])];if(r){var o=u[r.role];return"white"===r.color?o.toUpperCase():o}return"1"}).join("")}).join("/"))}var a=e("./util"),i="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",c={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},u={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};t.exports={initial:i,read:r,write:o}},{"./util":16}],13:[function(e,t,n){var r,o=function(){r=new Date},a=function(){r=null},i=function(){if(!r)return 0;var e=new Date-r;return r=null,e};t.exports={start:o,cancel:a,stop:i}},{}],14:[function(e,t,n){function r(e,t){return Math.abs(e-t)}function o(e,t,n,o,a){return r(t,o)<2&&("white"===e?a===n+1||2>=n&&a===n+2&&t===o:a===n-1||n>=7&&a===n-2&&t===o)}function a(e,t,n,o){var a=r(e,n),i=r(t,o);return 1===a&&2===i||2===a&&1===i}function i(e,t,n,o){return r(e,n)===r(t,o)}function c(e,t,n,r){return e===n||t===r}function u(e,t,n,r){return i(e,t,n,r)||c(e,t,n,r)}function l(e,t,n,o,a,i,c){return r(o,i)<2&&r(a,c)<2||n&&a===c&&a===("white"===e?1:8)&&(5===o&&(3===i||7===i)||f.containsX(t,i))}function s(e,t){return Object.keys(e).filter(function(n){var r=e[n];return r&&r.color===t&&"rook"===r.role}).map(function(e){return f.key2pos(e)[0]})}function d(e,t,n){var r,d=e[t],p=f.key2pos(t);switch(d.role){case"pawn":r=o.bind(null,d.color);break;case"knight":r=a;break;case"bishop":r=i;break;case"rook":r=c;break;case"queen":r=u;break;case"king":r=l.bind(null,d.color,s(e,d.color),n)}return f.allPos.filter(function(e){return(p[0]!==e[0]||p[1]!==e[1])&&r(p[0],p[1],e[0],e[1])}).map(f.pos2key)}var f=e("./util");t.exports=d},{"./util":16}],15:[function(e,t,n){function r(e,t){return(e?2:4)/512*t.width}function o(e,t,n){return(e.lineWidth||10)*(t?.7:1)/512*n.width}function a(e,t){return(e.opacity||1)*(t?.6:1)}function i(e,t){return h()?0:(e?10:20)/512*t.width}function c(e,t){var n=t.width/8;return[(e[0]-.5)*n,(8.5-e[1])*n]}function u(e,t,n,o){var i=c(t,o),u=r(n,o),l=o.width/16;return{tag:"circle",attrs:{key:n?"current":t+e.key,stroke:e.color,"stroke-width":u,fill:"none",opacity:a(e,n),cx:i[0],cy:i[1],r:l-u/2-e.circleMargin*u*1.5}}}function l(e,t,n,r,u){var l=i(r,u),s=c(t,u),d=c(n,u),f=d[0]-s[0],p=d[1]-s[1],v=Math.atan2(p,f),g=Math.cos(v)*l,m=Math.sin(v)*l;return{tag:"line",attrs:{key:r?"current":t+n+e.key,stroke:e.color,"stroke-width":o(e,r,u),"stroke-linecap":"round","marker-end":h()?null:"url(#arrowhead-"+e.key+")",opacity:a(e,r),x1:s[0],y1:s[1],x2:d[0]-g,y2:d[1]-m}}}function s(e){return{tag:"defs",children:[e.map(function(e){return{key:e.key,tag:"marker",attrs:{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01},children:[{tag:"path",attrs:{d:"M0,0 V4 L3,2 Z",fill:e.color}}]}})]}}function d(e,t){return"white"===t?e:[9-e[0],9-e[1]]}function f(e,t,n,r){return function(o){return o.orig&&o.dest?l(n[o.brush],d(p(o.orig),e),d(p(o.dest),e),t,r):o.orig?u(n[o.brush],d(p(o.orig),e),t,r):void 0}}var p=(e("mithril"),e("./util").key2pos),h=e("./util").isTrident;t.exports=function(e){if(e.data.bounds){var t=e.data.drawable,n=t.shapes.concat(t.autoShapes);if(n.length||t.current.orig){var r=e.data.bounds();if(r.width===r.height){var o=Object.keys(e.data.drawable.brushes).filter(function(e){return t.current&&t.current.dest&&t.current.brush===e||n.filter(function(t){return t.dest&&t.brush===e}).length}).map(function(t){return e.data.drawable.brushes[t]});return{tag:"svg",children:[s(o),n.map(f(e.data.orientation,!1,e.data.drawable.brushes,r)),f(e.data.orientation,!0,e.data.drawable.brushes,r)(t.current)]}}}}}},{"./util":16,mithril:3}],16:[function(e,t,n){function r(e){return k[e[0]-1]+e[1]}function o(e){return[k.indexOf(e[0])+1,parseInt(e[1])]}function a(e){return k[7-k.indexOf(e[0])]+(9-parseInt(e[1]))}function i(e){var t=[];for(var n in e)e[n]&&t.push(n);return t.join(" ")}function c(e){return"white"===e?"black":"white"}function u(e,t){return e&&(e[0]===t||e[1]===t)}function l(e,t){return e&&-1!==e.indexOf(t)}function s(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function d(){return"transform"in document.body.style?"transform":"webkitTransform"in document.body.style?"webkitTransform":"mozTransform"in document.body.style?"mozTransform":"oTransform"in document.body.style?"oTransform":"msTransform"}function f(){return w||(w=d()),w}function p(){return null===O&&(O=window.navigator.userAgent.indexOf("Trident/")>-1),O}function h(e){return"translate("+e[0]+"px,"+e[1]+"px)"}function v(e){return e.touches?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:[e.clientX,e.clientY]}function g(e,t){return e.bind.apply(e,[null].concat(t))}function m(){return g(arguments[0],Array.prototype.slice.call(arguments,1))}function b(e){return 2===e.buttons||2===e.button}function y(e){var t,n=function(){return void 0===t&&(t=e()),t};return n.clear=function(){t=void 0},n}var w,k="abcdefgh".split(""),x=[1,2,3,4,5,6,7,8],C=[8,7,6,5,4,3,2,1],P=function(){var e=[];return C.forEach(function(t){x.forEach(function(n){e.push([n,t])})}),e}(),E=P.slice().reverse(),M=P.map(r),O=null;t.exports={files:k,ranks:x,invRanks:C,allPos:P,invPos:E,allKeys:M,pos2key:r,key2pos:o,invertKey:a,classSet:i,opposite:c,translate:h,contains2:u,containsX:l,distance:s,eventPosition:v,partialApply:g,partial:m,transformProp:f,isTrident:p,requestAnimationFrame:(window.requestAnimationFrame||window.setTimeout).bind(window),isRightButton:b,memo:y}},{}],17:[function(e,t,n){function r(e){return e.role+" "+e.color}function o(e,t,n){var o={style:{},"class":r(n)},a=e.data.draggable.current;if(a.orig===t&&a.started)o.style[v.transformProp()]=v.translate([a.pos[0]+a.dec[0],a.pos[1]+a.dec[1]]),o["class"]+=" dragging";else if(e.data.animation.current.anims){var i=e.data.animation.current.anims[t];i&&(o.style[v.transformProp()]=v.translate(i[1]))}return{tag:"piece",attrs:o}}function a(e){return{tag:"piece",attrs:{"class":r(e)+" ghost"}}}function i(e,t,n){var r=e.data,i=v.files[t[0]-1],c=t[1],u=i+c,l=r.pieces[u],s=r.highlight.dragOver&&r.draggable.current.over===u,d=v.classSet({selected:r.selected===u,check:r.highlight.check&&r.check===u,"last-move":r.highlight.lastMove&&v.contains2(r.lastMove,u),"move-dest":(s||r.movable.showDests)&&v.containsX(r.movable.dests[r.selected],u),"premove-dest":(s||r.premovable.showDests)&&v.containsX(r.premovable.dests,u),"current-premove":u===r.predroppable.current.key||v.contains2(r.premovable.current,u),"drag-over":s,oc:!!l});e.vm.exploding&&-1!==e.vm.exploding.keys.indexOf(u)&&(d+=" exploding"+e.vm.exploding.stage);var f={style:{left:12.5*(n?t[0]-1:8-t[0])+"%",bottom:12.5*(n?t[1]-1:8-t[1])+"%"}};d&&(f["class"]=d),r.coordinates&&(t[1]===(n?1:8)&&(f["data-coord-x"]=i),t[0]===(n?8:1)&&(f["data-coord-y"]=c));var p=[];return l&&(p.push(o(e,u,l)),r.draggable.current.orig===u&&r.draggable.showGhost&&!r.draggable.current.newPiece&&p.push(a(l))),{tag:"square",attrs:f,children:p}}function c(e){return{tag:"square",attrs:{"class":"fading",style:{left:e.left,bottom:e.bottom,opacity:e.opacity}},children:[{tag:"piece",attrs:{"class":r(e.piece)}}]}}function u(e,t){var n=[];e.data.lastMove&&e.data.lastMove.forEach(function(e){var r=v.key2pos(e);n.push({tag:"square",attrs:{"class":"last-move",style:{left:12.5*(t?r[0]-1:8-r[0])+"%",bottom:12.5*(t?r[1]-1:8-r[1])+"%"}}})});for(var o=Object.keys(e.data.pieces),a=0,i=o.length;i>a;a++){var c=o[a],u=v.key2pos(c),l={style:{left:12.5*(t?u[0]-1:8-u[0])+"%",bottom:12.5*(t?u[1]-1:8-u[1])+"%"},"class":r(e.data.pieces[c])};if(e.data.animation.current.anims){var s=e.data.animation.current.anims[c];s&&(l.style[v.transformProp()]=v.translate(s[1]))}n.push({tag:"piece",attrs:l})}return n}function l(e){var t="white"===e.data.orientation;if(e.data.minimalDom)return u(e,t);for(var n=t?v.allPos:v.invPos,r=[],o=0,a=n.length;a>o;o++)r.push(i(e,n[o],t));return e.data.animation.current.fadings&&e.data.animation.current.fadings.forEach(function(e){r.push(c(e))}),e.data.drawable.enabled&&r.push(g(e)),r}function s(e,t,n){return function(r){v.isRightButton(r)&&e.draggable.current.orig?(e.draggable.current.newPiece&&delete e.pieces[e.draggable.current.orig],e.draggable.current={},e.selected=null):e.drawable.enabled&&(r.shiftKey||v.isRightButton(r))?n(e,r):e.viewOnly||t(e,r)}}function d(e,t,n){var r=e.data,o=s(r,p.start,h.start),a=s(r,p.move,h.move),i=s(r,p.end,h.end),c=["touchstart","mousedown"],u=["touchmove","mousemove"],l=["touchend","mouseup"];c.forEach(function(e){t.addEventListener(e,o)}),u.forEach(function(e){document.addEventListener(e,a)}),l.forEach(function(e){document.addEventListener(e,i)}),n.onunload=function(){c.forEach(function(e){t.removeEventListener(e,o)}),u.forEach(function(e){document.removeEventListener(e,a)}),l.forEach(function(e){document.removeEventListener(e,i)})}}function f(e){return{tag:"div",attrs:{"class":"cg-board orientation-"+e.data.orientation,config:function(t,n,r){n||((!e.data.viewOnly||e.data.drawable.enabled)&&d(e,t,r),e.data.render=function(){m.render(t,l(e))},e.data.renderRAF=function(){v.requestAnimationFrame(e.data.render)},e.data.bounds=v.memo(t.getBoundingClientRect.bind(t)),e.data.element=t,e.data.render())}},children:[]}}var p=e("./drag"),h=e("./draw"),v=e("./util"),g=e("./svg"),m=e("mithril");t.exports=function(e){return{tag:"div",attrs:{config:function(t,n){n||(t.addEventListener("contextmenu",function(t){return e.data.disableContextMenu||e.data.drawable.enabled?(t.preventDefault(),!1):void 0}),e.data.resizable&&document.body.addEventListener("chessground.resize",function(t){e.data.bounds.clear(),e.data.render()},!1),["onscroll","onresize"].forEach(function(t){var n=window[t];window[t]=function(){n&&n(),e.data.bounds.clear()}}))},"class":["cg-board-wrap",e.data.viewOnly?"view-only":"manipulable",e.data.minimalDom?"minimal-dom":"full-dom"].join(" ")},children:[f(e)]}}},{"./drag":10,"./draw":11,"./svg":15,"./util":16,mithril:3}]},{},[1])(1)});